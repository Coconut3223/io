<!DOCTYPE html>

<html lang="zh-CN" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="../_static/javascripts/modernizr.js"></script>
  
  
  
    <title>MapReduce &#8212; HomePage</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=83e35b93" />
    <link rel="stylesheet" type="text/css" href="../_static/material.css?v=79c92029" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/katex-math.css?v=91adb8b6" />
    <link rel="stylesheet" type="text/css" href="../_static/css/rtd_sphinx_search.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/def.css?v=5a9d86bd" />
    <script src="../_static/documentation_options.js?v=7d86a446"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=9f22d18c"></script>
    <script src="../_static/translations.js?v=beaddf03"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../_static/js/rtd_search_config.js"></script>
    <script src="../_static/js/rtd_sphinx_search.min.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="other" href="other.html" />
    <link rel="prev" title="(Apache 基金会的) Hadoop" href="hadoop.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=blue data-md-color-accent=cyan>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#utils/mapreduce" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../index.html" title="HomePage"
           class="md-header-nav__button md-logo">
          
            <i class="md-icon">&#xe869</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">Cocobook</span>
          <span class="md-header-nav__topic"> MapReduce </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder=""Search""
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/Coconut3223/io/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    io
  </div>
</a>
          </div>
        </div>
      
      
    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
          <li class="md-tabs__item"><a href="../index.html" class="md-tabs__link">HomePage</a></li>
            
            <li class="md-tabs__item"><a href="../AI/index.html" class="md-tabs__link">AI</a></li>
            
            <li class="md-tabs__item"><a href="../python/index.html" class="md-tabs__link">Python</a></li>
            
            <li class="md-tabs__item"><a href="../NLP/index.html" class="md-tabs__link">NLP</a></li>
            
            <li class="md-tabs__item"><a href="../SQL/index.html" class="md-tabs__link">SQL</a></li>
            
            <li class="md-tabs__item"><a href="index.html" class="md-tabs__link">Utils</a></li>
            
            <li class="md-tabs__item"><a href="../frontend/index.html" class="md-tabs__link">Frontend</a></li>
          <li class="md-tabs__item"><a href="index.html" class="md-tabs__link">杂</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="HomePage" class="md-nav__button md-logo">
      
        <i class="md-icon">&#xe869</i>
      
    </a>
    <a href="../index.html"
       title="HomePage">Cocobook</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/Coconut3223/io/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    io
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">Content</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../AI/index.html" class="md-nav__link">AI</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../AI/ML/index.html" class="md-nav__link">ML</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../AI/DL/index.html" class="md-nav__link">DL</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../CV/index.html" class="md-nav__link">CV</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../NLP/index.html" class="md-nav__link">NLP</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../python/index.html" class="md-nav__link">python</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../SQL/index.html" class="md-nav__link">SQL</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="index.html" class="md-nav__link">utils</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="index.html#id2" class="md-nav__link">好用的网站</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="index.html#id4" class="md-nav__link">目录</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../frontend/index.html" class="md-nav__link">frontend</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">"Contents"</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#utils-mapreduce--page-root" class="md-nav__link">MapReduce</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#background" class="md-nav__link">background</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#ideas-distributed-processing" class="md-nav__link">Ideas： Distributed Processing</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#map-reduce" class="md-nav__link">Map-Reduce</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#messy-details-in-map-reduce-runtime-library" class="md-nav__link">messy details in Map-Reduce runtime library 潜在的一些问题</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#automatic-parallelization" class="md-nav__link">automatic parallelization</a>
        </li>
        <li class="md-nav__item"><a href="#load-balancing" class="md-nav__link">load balancing</a>
        </li>
        <li class="md-nav__item"><a href="#handling-of-machine-failures" class="md-nav__link">handling of machine failures</a>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#workflow" class="md-nav__link">Workflow</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#map" class="md-nav__link">Map</a>
        </li>
        <li class="md-nav__item"><a href="#shuffle-sort-and-segment" class="md-nav__link">Shuffle: Sort and Segment</a>
        </li>
        <li class="md-nav__item"><a href="#reduce" class="md-nav__link">Reduce</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#example" class="md-nav__link">Example</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#the-average-gpa-for-the-male-students-in-each-year-from-table-student" class="md-nav__link">the average gpa for the male students in each year from table Student</a>
        </li>
        <li class="md-nav__item"><a href="#wordcount" class="md-nav__link">Wordcount</a>
        </li>
        <li class="md-nav__item"><a href="#k-means-with-mapreduce" class="md-nav__link">K-Means with MapReduce</a>
        </li>
        <li class="md-nav__item"><a href="#find-the-most-pleasant-date" class="md-nav__link">Find the most pleasant date</a>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li>
  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <section id="mapreduce">
<h1 id="utils-mapreduce--page-root">MapReduce<a class="headerlink" href="#utils-mapreduce--page-root" title="Link to this heading">¶</a></h1>
<section id="background">
<h2 id="background">background<a class="headerlink" href="#background" title="Link to this heading">¶</a></h2>
<p>以前我们设计数据库以及其 transaction 操作最迫切地要求是 <strong>make sure the transactions safe and consistent</strong>，确保这项 transaction 安全一致。除此之外满足：<strong>the throughput, the reliability, the asset property 吞吐量、可靠性、资产属性。</strong></p>
<p>但是对于谷歌，一个做 search的，最迫切的是快。无论是能马上返回用户搜索的结果的快，还是 break down之后能马上重启的快（the fault tolerance 容错， <strong>most important</strong>）。前者需要多台机器共同协作，后者需要多台机器独立并足够备份。根本就是 parallel machines→ <strong>distributed processing</strong> 。考虑到预算，他们发明了Map-Reduce，并不需要很昂贵的机器，而是用&lt;u&gt;非常多台性能一般并 heterogeneous （异构不一样结构）&lt;/u&gt;机器去运行维护。</p>
<p><strong>Why not Parallel DBMS ?</strong></p>
<table>
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>Parallel DBMS</p></th>
<th class="head"><p>we need</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>most important</p></td>
<td><p>speed</p></td>
<td><p>the fault tolerance</p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><p>machine</p></td>
<td><p>Use of 10-100 high-end and preferably homogenous set of machines</p></td>
<td><p>Cluster of thousands of heterogeneouslow-end servers</p></td>
</tr>
<tr class="row-even"><td><p>少，高端，相同结构</p></td>
<td><p>大量，可以不一样结构，低端</p></td>
</tr>
<tr class="row-odd"><td rowspan="3"><p>transaction</p></td>
<td><p>Long loading time: good for load-once, query many times</p></td>
<td><p>directly reads the file and processes the data</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>加载不行</p></td>
<td><p>Just load the used data, process it, and go</p></td>
</tr>
<tr class="row-odd"><td><p>疯狂需要加载</p></td>
</tr>
</tbody>
</table>
<section id="ideas-distributed-processing">
<h3 id="ideas-distributed-processing">Ideas： Distributed Processing<a class="headerlink" href="#ideas-distributed-processing" title="Link to this heading">¶</a></h3>
<p>In a computing cluster, a <span class="defi">worker node</span> is a computer that works on data. Data is split into several parts</p>
<p><strong>Details:</strong></p>
<ol class="arabic simple">
<li><p>incorrect results by wrong update</p></li>
</ol>
<table>
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>Locking-based Solution</p></th>
<th class="head"><p>MapReduce</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td rowspan="2"><p>how to works</p></td>
<td><p>must hold a lock on data before using Read/Write</p></td>
<td><p>using its local storage,send their local arrays to the central node</p></td>
</tr>
<tr class="row-odd"><td><p>谁在读写就锁上，防止同时读写</p></td>
<td><p>本地自己读写，再统一发到中心点update</p></td>
</tr>
<tr class="row-even"><td rowspan="3"><p>Disadvantage</p></td>
<td><ol class="arabic simple">
<li><p>Complicate the implementation</p></li>
</ol>
</td>
<td><p>postpone the corporation to the end of the task &amp;</p></td>
</tr>
<tr class="row-odd"><td><ol class="arabic simple" start="2">
<li><p>Expensive runtime overhead.</p></li>
</ol>
</td>
<td rowspan="2"><p>the most of the time they’re running in parallel without waiting.</p></td>
</tr>
<tr class="row-even"><td><p>因为1在读写的时候，同样也访问这个东西的2就会被迫suspend</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="map-reduce">
<h2 id="map-reduce">Map-Reduce<a class="headerlink" href="#map-reduce" title="Link to this heading">¶</a></h2>
<p><span class="defi">Map-Reduce</span> . A simple programming model that applies to many <strong>large-scale</strong> computing problems</p>
<ul class="simple">
<li><p>ability to explore <strong>large-scale cloud resources</strong></p></li>
<li><p>inherently designed for <strong>batch and high throughput</strong> 专为 <strong>批处理和高吞吐量</strong> 而设计</p></li>
</ul>
<section id="messy-details-in-map-reduce-runtime-library">
<h3 id="messy-details-in-map-reduce-runtime-library">messy details in Map-Reduce runtime library 潜在的一些问题<a class="headerlink" href="#messy-details-in-map-reduce-runtime-library" title="Link to this heading">¶</a></h3>
<section id="automatic-parallelization">
<h4 id="automatic-parallelization">automatic parallelization<a class="headerlink" href="#automatic-parallelization" title="Link to this heading">¶</a></h4>
<p>既然是平行，那么就有可能</p>
<ol class="arabic simple">
<li><dl class="simple">
<dt>同时process同一份data，就会重复</dt><dd><ul class="simple">
<li><p>Do not allow workers to access shared data immediately</p></li>
<li><p>Do not allow workers to interrupt each other</p></li>
<li><p>Processing data sequentially to avoid random access</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>完成独立任务后，怎么合成成果</dt><dd><ul class="simple">
<li><p>Move operations near the data</p></li>
<li><p>MapReduce assumes an architecture where processors and storage are co-located</p></li>
<li><p>When workers finish, perform batch updates</p></li>
</ul>
</dd>
</dl>
</li>
</ol>
</section>
<section id="load-balancing">
<h4 id="load-balancing">load balancing<a class="headerlink" href="#load-balancing" title="Link to this heading">¶</a></h4>
<p><strong>network and disk transfer optimization：</strong></p>
<p>Cluster of thousands of heterogeneous low-end servers</p>
<ul class="simple">
<li><p>Hide system-level details from the application developer</p></li>
<li><p>Simple and well-defined interfaces between a small number of components</p></li>
<li><dl class="simple">
<dt>When workers finish, perform batch updates</dt><dd><p>The reason is that random access will move the drive from one location to the other and take a longer time if the data is sequentially stored, one read will be upload will be will be uploading everything in in in in, in once. So the IO time is very limited.</p>
</dd>
</dl>
</li>
</ul>
</section>
<section id="handling-of-machine-failures">
<h4 id="handling-of-machine-failures">handling of machine failures<a class="headerlink" href="#handling-of-machine-failures" title="Link to this heading">¶</a></h4>
<p>Assume failures are common§ Fault-tolerant service must cope with failures</p>
<p>without impacting the quality of service</p>
</section>
</section>
</section>
<section id="workflow">
<h2 id="workflow">Workflow<a class="headerlink" href="#workflow" title="Link to this heading">¶</a></h2>
<a class="reference internal image-reference" href="../_images/MapR_1.png"><img alt="../_images/MapR_1.png" class="align-center" src="../_images/MapR_1.png" style="width: 742.0px; height: 343.0px;"/>
</a>
<a class="reference internal image-reference" href="../_images/MapR_2.png"><img alt="../_images/MapR_2.png" class="align-center" src="../_images/MapR_2.png" style="width: 539.1px; height: 352.8px;"/>
</a>
<a class="reference internal image-reference" href="../_images/MapR_3.png"><img alt="../_images/MapR_3.png" class="align-center" src="../_images/MapR_3.png" style="width: 482.40000000000003px; height: 295.2px;"/>
</a>
<p><strong>key-points：</strong></p>
<ol class="arabic simple">
<li><p>definition of key-value pairs</p></li>
</ol>
<section id="map">
<h3 id="map">Map<a class="headerlink" href="#map" title="Link to this heading">¶</a></h3>
<p>a <strong>mapping</strong> that is responsible for</p>
<ol class="arabic simple">
<li><p>dividing the data</p></li>
<li><p>transform the original data into key-value pairs <strong>``input data → (key, value) pairs``</strong></p></li>
<li><p>produces set of intermediate pairs</p></li>
</ol>
</section>
<section id="shuffle-sort-and-segment">
<h3 id="shuffle-sort-and-segment">Shuffle: Sort and Segment<a class="headerlink" href="#shuffle-sort-and-segment" title="Link to this heading">¶</a></h3>
<p>the process of further organizing and delivering the Map output to the Reduce</p>
<ol class="arabic simple">
<li><p>the output of the Map must be sorted and segmented <strong>Sorting is done before calling “reduce”</strong></p></li>
<li><p>then passed to the corresponding Reduce</p></li>
</ol>
</section>
<section id="reduce">
<h3 id="reduce">Reduce<a class="headerlink" href="#reduce" title="Link to this heading">¶</a></h3>
<p>a <strong>merge</strong> that</p>
<ol class="arabic simple">
<li><dl class="simple">
<dt>processes the values with the same key <code class="docutils literal notranslate"><span class="pre">(key,</span> <span class="pre">value)</span> <span class="pre">pairs</span> <span class="pre">→</span> <span class="pre">&lt;result&gt;</span></code></dt><dd><p><strong>All pairs in the same “reduce” call share the same key</strong></p>
</dd>
</dl>
</li>
<li><p>produces a set of merged output values</p></li>
</ol>
</section>
</section>
<section id="example">
<h2 id="example">Example<a class="headerlink" href="#example" title="Link to this heading">¶</a></h2>
<section id="the-average-gpa-for-the-male-students-in-each-year-from-table-student">
<h3 id="the-average-gpa-for-the-male-students-in-each-year-from-table-student">the average gpa for the male students in each year from table Student<a class="headerlink" href="#the-average-gpa-for-the-male-students-in-each-year-from-table-student" title="Link to this heading">¶</a></h3>
<p><strong>Input:</strong> Given a 10TB table: Student(id, name, year, gpa, gender)</p>
<p><strong>Target:</strong> Finish the SQL Execution</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>SELECT<span class="w"> </span>year,<span class="w"> </span>AVG<span class="o">(</span>gpa<span class="o">)</span>
FROM<span class="w"> </span>Student
WHERE<span class="w"> </span><span class="nv">gender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>‘Male’
GROUP<span class="w"> </span>BY<span class="w"> </span>year
</pre></div>
</div>
<p><strong>Map:</strong></p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">Map</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">Record</span><span class="w"> </span><span class="n">value</span><span class="p">){</span>
<span class="w">    </span><span class="c1">// key: table name</span>
<span class="w">    </span><span class="c1">// value: table content</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">value</span><span class="o">:</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">row</span><span class="p">.</span><span class="n">gender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">‘</span><span class="n">Male</span><span class="err">’</span><span class="p">)</span><span class="o">:</span>
<span class="w">            </span><span class="n">emit</span><span class="p">(</span><span class="n">row</span><span class="p">.</span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">row</span><span class="p">.</span><span class="n">gpa</span><span class="p">)</span><span class="w"> </span><span class="c1">// intermediate key value pairs</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Reduce:</strong></p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">Reduce</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">Iterator</span><span class="w"> </span><span class="n">values</span><span class="p">){</span>
<span class="w">    </span><span class="c1">// key: year</span>
<span class="w">    </span><span class="c1">// values: a list of gpa</span>
<span class="w">    </span><span class="n">sumGPA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="n">gpa</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">values</span><span class="o">:</span>
<span class="w">        </span><span class="n">sumGPA</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">gpa</span>
<span class="w">    </span><span class="n">emit</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">sumGPA</span><span class="o">/</span><span class="k">sizeof</span><span class="p">(</span><span class="n">values</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="wordcount">
<h3 id="wordcount">Wordcount<a class="headerlink" href="#wordcount" title="Link to this heading">¶</a></h3>
<a class="reference internal image-reference" href="../_images/MapR_4.png"><img alt="../_images/MapR_4.png" class="align-center" src="../_images/MapR_4.png" style="width: 771.2px; height: 505.6px;"/>
</a>
<p><strong>Input:</strong></p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"/content/drive/MyDrive/COMP5434-TA/input.txt"</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span>
<span class="n">input_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Map:</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">char.strip()</span></code>  # 去除首尾空格</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">Map</span><span class="p">():</span>
    <span class="k">while</span> <span class="n">has</span> <span class="n">lines</span> <span class="n">left</span><span class="p">:</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">Read</span> <span class="n">a</span> <span class="n">line</span>
        <span class="n">S</span> <span class="o">=</span> <span class="n">tokenize</span><span class="p">(</span><span class="n">L</span><span class="p">)</span> <span class="c1"># S is a list of tokens</span>
        <span class="k">for</span> <span class="n">each</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">S</span><span class="p">:</span>
            <span class="n">emit</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">1</span><span class="p">);</span> <span class="c1"># k: word, v:1</span>
</pre></div>
</div>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">map</span><span class="p">(</span><span class="n">input_data</span><span class="p">):</span>
<span class="n">map_result</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">input_data</span><span class="p">:</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">" "</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">" "</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">word</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="s2">"1"</span><span class="p">]))</span>
    <span class="n">map_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">" "</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">word</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="s2">"1"</span><span class="p">]))</span>
<span class="k">return</span> <span class="n">map_result</span>

<span class="n">map_result</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">map_result</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Reduce:</strong></p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">Reduce</span><span class="p">(</span><span class="n">k</span><span class="p">:</span> <span class="n">word</span><span class="p">,</span> <span class="n">value_list</span><span class="p">):</span>
    <span class="n">emit</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">value_list</span><span class="p">))</span> <span class="c1"># k:word, v:wordcount</span>
</pre></div>
</div>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="n">map_result</span><span class="p">):</span>
    <span class="n">word_cound_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">map_result</span><span class="p">:</span>
        <span class="n">kv</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">" "</span><span class="p">)</span>
        <span class="n">word</span> <span class="o">=</span> <span class="n">kv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">kv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="n">word_cound_dict</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="n">word_cound_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">count</span>
    <span class="n">sorted_word_count</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">word_cound_dict</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">sorted_word_count</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">" "</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">word</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">)]))</span>

<span class="n">reduce</span><span class="p">(</span><span class="n">map_result</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="k-means-with-mapreduce">
<h3 id="k-means-with-mapreduce">K-Means with MapReduce<a class="headerlink" href="#k-means-with-mapreduce" title="Link to this heading">¶</a></h3>
<a class="reference internal image-reference" href="../_images/MapR_5.png"><img alt="../_images/MapR_5.png" class="align-center" src="../_images/MapR_5.png" style="width: 692.0px; height: 385.0px;"/>
</a>
<ul class="simple">
<li><p>Each Mapper loads a set of data samples, and assign each sample to a nearest centroid</p></li>
<li><p>Each Mapper needs to keep a copy of centroids</p></li>
</ul>
</section>
<section id="find-the-most-pleasant-date">
<h3 id="find-the-most-pleasant-date">Find the most pleasant date<a class="headerlink" href="#find-the-most-pleasant-date" title="Link to this heading">¶</a></h3>
<a class="reference internal image-reference" href="../_images/MapR_6.png"><img alt="../_images/MapR_6.png" class="align-center" src="../_images/MapR_6.png" style="width: 515.0px; height: 377.0px;"/>
</a>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">Map</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">each</span> <span class="n">turple</span><span class="p">(</span><span class="n">City</span><span class="p">,</span> <span class="n">Data</span><span class="p">,</span> <span class="n">Time</span><span class="p">,</span> <span class="n">Temperature</span><span class="p">)</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">table</span><span class="p">:</span>
        <span class="n">Temperature</span> <span class="o">=</span> <span class="n">Temperature</span><span class="p">,</span><span class="n">strip</span><span class="p">(</span><span class="s2">"C"</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">Date</span> <span class="o">+</span> <span class="s2">"-"</span> <span class="o">+</span> <span class="n">Temperature</span>
        <span class="n">emit</span><span class="p">(</span><span class="n">City</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>  <span class="c1"># k:city, v:date+temperature</span>
</pre></div>
</div>
<table>
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>Mapper1</p></th>
<th class="head"><p>Mapper2</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td rowspan="6"><p>output</p></td>
<td><p>Beijing, 2020/10/1-26</p></td>
<td><p>Shanghai, 2020/10/3-30</p></td>
</tr>
<tr class="row-odd"><td><p>Beijing, 2020/10/2-36</p></td>
<td><p>Shanghai, 2020/10/4-29</p></td>
</tr>
<tr class="row-even"><td><p>Beijing, 2020/10/3-27</p></td>
<td><p>Hongkong, 2020/10/1-33</p></td>
</tr>
<tr class="row-odd"><td><p>Beijing, 2020/10/4-18</p></td>
<td><p>Hongkong, 2020/10/2-31</p></td>
</tr>
<tr class="row-even"><td><p>Shanghai, 2020/10/1-36</p></td>
<td><p>Hongkong, 2020/10/3-40</p></td>
</tr>
<tr class="row-odd"><td><p>Shanghai, 2020/10/2-34</p></td>
<td><p>Hongkong, 2020/10/4-27</p></td>
</tr>
</tbody>
</table>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">Rdeuce</span><span class="p">(</span><span class="n">k</span><span class="p">:</span><span class="n">city</span><span class="p">,</span> <span class="n">value_list</span><span class="p">):</span>
    <span class="n">tem_abs</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">date_pleasant</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">each</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">value_list</span><span class="p">:</span>
        <span class="n">date</span><span class="p">,</span> <span class="n">temperature</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">strp</span><span class="p">(</span><span class="s2">"-"</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tem_abs</span><span class="p">:</span>
            <span class="n">date_pleasant</span> <span class="o">=</span> <span class="n">date</span>
            <span class="n">tem_abs</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
    <span class="n">emit</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">date_pleasant</span><span class="p">)</span> <span class="c1"># k:city, v:date_pleasant</span>
</pre></div>
</div>
<table>
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>Reducer1</p></th>
<th class="head"><p>Reducer2</p></th>
<th class="head"><p>Reducer3</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>input</p></td>
<td><p>Beijing, 2020/10/1-26</p></td>
<td><p>Shanghai, 2020/10/1-36</p></td>
<td><p>Hongkong, 2020/10/1-33</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>Beijing, 2020/10/2-36</p></td>
<td><p>Shanghai, 2020/10/2-34</p></td>
<td><p>Hongkong, 2020/10/2-31</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>Beijing, 2020/10/3-27</p></td>
<td><p>Shanghai, 2020/10/3-30</p></td>
<td><p>Hongkong, 2020/10/3-40</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>Beijing, 2020/10/4-18</p></td>
<td><p>Shanghai, 2020/10/4-29</p></td>
<td><p>Hongkong, 2020/10/4-27</p></td>
</tr>
<tr class="row-even"><td><p>output</p></td>
<td><p>Beijing, 2020/10/1</p></td>
<td><p>Shanghai, 2020/10/4</p></td>
<td><p>Hongkong, 2020/10/4</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>Map and Reduce are the main operations: simple code</p></li>
<li><p>§ All Map should be completed before Reduce starts</p></li>
<li><p>§ Number of map tasks and reduce tasks are configurable</p></li>
<li><p>§ Operations are provisioned near the data</p></li>
<li><p>§ Commodity hardware and storage</p></li>
<li><p>§ Runtime takes care of splitting and moving data</p></li>
<li><p>§ Special distributed file system, e.g., Hadoop Distributed File System and Hadoop Runtime</p></li>
</ul>
</section>
</section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="hadoop.html" title="(Apache 基金会的) Hadoop"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> "Previous" </span> (Apache 基金会的) Hadoop </span>
              </div>
            </a>
          
          
            <a href="other.html" title="other"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> "Next" </span> other </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2024, coconut.
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 8.0.2.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>